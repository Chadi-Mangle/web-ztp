{% extends "base_with_navbar.html" %}
{% load crispy_forms_tags %}

{% block fragment %}
<div class="container mt-4">
    {% crispy form %}
</div>

<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>

<script>
$(document).ready(function() {
    function updateIpRange() {
        const subnet = $('#id_subnet').val().trim();
        const subnetParts = subnet.split('.');
        if (subnetParts.length < 3) return;
        
        const base = subnetParts.slice(0, 3).join('.') + '.';
        const values = $("#slider-range").slider("values");
        const minVal = values[0];
        const maxVal = values[1];
        
        $("#ip-range-display").text(base + minVal + " - " + base + maxVal);
        $("#id_min_ip_pool").val(base + minVal);
        $("#id_max_ip_pool").val(base + maxVal);
    }

    function initSlider() {
        const subnet = $('#id_subnet').val().trim();
        const subnetParts = subnet.split('.');
        
        if (subnetParts.length >= 3) {
            let currentMin = 100;
            let currentMax = 200;
            
            const minIp = $("#id_min_ip_pool").val();
            if (minIp) {
                const minParts = minIp.split('.');
                if (minParts.length === 4) currentMin = parseInt(minParts[3]) || currentMin;
            }
            
            const maxIp = $("#id_max_ip_pool").val();
            if (maxIp) {
                const maxParts = maxIp.split('.');
                if (maxParts.length === 4) currentMax = parseInt(maxParts[3]) || currentMax;
            }
            
            $("#slider-range").slider({
                range: true,
                min: 2, 
                max: 254,
                values: [currentMin, currentMax],
                slide: updateIpRange,
                change: updateIpRange
            });
            
            updateIpRange();
        }
    }
    
    initSlider();
    $('#id_subnet').on('change input', initSlider);
});
</script>

<style>
.ip-range-slider {
    margin: 15px 0;
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    border: 1px solid #ced4da;
}

.ip-range-slider .ui-slider-handle {
    width: 20px;
    height: 20px;
    top: -7px;
    margin-left: -10px;
    border-radius: 50%;
    border: 2px solid #0D6EFD;  
    background: white;
    cursor: pointer;
    outline: none;
    transition: all 0.2s;
}

.ip-range-slider .ui-slider-handle:hover {
    transform: scale(1.1);
    border-color: #0a58ca; 
}

.ip-range-slider .ui-slider-range {
    background: #0D6EFD;  
    height: 8px;
    border-radius: 4px;
}

#ip-range-display {
    color: #000000;  
    font-weight: bold;
    padding: 8px 0;
    font-size: 1rem;
}
</style>
{% endblock %}